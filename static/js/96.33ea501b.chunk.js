(()=>{"use strict";function e(e){return(""+e).toLowerCase().replace(/[^a-z0-9]+/g,"")}var t=new class{constructor(){this.ARGS={"|init|":1,"|title|":1,"|users|":1,"||":1,"|html|":1,"|uhtml|":1,"|pagehtml|":1,"|uhtmlchange|":1,"|join|":1,"|leave|":1,"|name|":1,"|chat|":1,"|notify|":1,"|:|":1,"|c:|":1,"|t:|":1,"|battle|":1,"|popup|":1,"|pm|":1,"|usercount|":1,"|nametaken|":1,"|challstr|":1,"|updateuser|":1,"|formats|":1,"|updatesearch|":1,"|message|":1,"|updatechallenges|":1,"|queryresponse|":1,"|unlink|":1,"|raw|":1,"|error|":1,"|bigerror|":1,"|chatmsg|":1,"|chatmsg-raw|":1,"|controlshtml|":1,"|fieldhtml|":1,"|debug|":1,"|deinit|":1,"|selectorhtml|":1,"|refresh|":1,"|tempnotify|":1,"|tempnotifyoff|":1,"|noinit|":1,"|hidelines|":1,"|expire|":1,"|askreg|":1,"|tournament|create|":1,"|tournament|update|":1,"|tournament|updateEnd|":1,"|tournament|error|":1,"|tournament|forceend|":1,"|tournament|join|":1,"|tournament|leave|":1,"|tournament|replace|":1,"|tournament|start|":1,"|tournament|disqualify|":1,"|tournament|battlestart|":1,"|tournament|battleend|":1,"|tournament|end|":1,"|tournament|scouting|":1,"|tournament|autostart|":1,"|tournament|autodq|":1,"|player|":1,"|teamsize|":1,"|gametype|":1,"|gen|":1,"|tier|":1,"|rated|":1,"|seed|":1,"|rule|":1,"|teampreview|":1,"|clearpoke|":1,"|poke|":1,"|start|":1,"|done|":1,"|request|":1,"|inactive|":1,"|inactiveoff|":1,"|upkeep|":1,"|turn|":1,"|win|":1,"|tie|":1,"|move|":1,"|switch|":1,"|drag|":1,"|detailschange|":1,"|replace|":1,"|swap|":1,"|cant|":1,"|faint|":1,"|-formechange|":1,"|-fail|":1,"|-block|":1,"|-notarget|":1,"|-miss|":1,"|-damage|":1,"|-heal|":1,"|-sethp|":1,"|-status|":1,"|-curestatus|":1,"|-cureteam|":1,"|-boost|":1,"|-unboost|":1,"|-setboost|":1,"|-swapboost|":1,"|-invertboost|":1,"|-clearboost|":1,"|-clearallboost|":1,"|-clearpositiveboost|":1,"|-ohko|":1,"|-clearnegativeboost|":1,"|-copyboost|":1,"|-weather|":1,"|-fieldstart|":1,"|-fieldend|":1,"|-sidestart|":1,"|-sideend|":1,"|-start|":1,"|-end|":1,"|-crit|":1,"|-supereffective|":1,"|-resisted|":1,"|-immune|":1,"|-item|":1,"|-enditem|":1,"|-ability|":1,"|-endability|":1,"|-transform|":1,"|-mega|":1,"|-primal|":1,"|-burst|":1,"|-zpower|":1,"|-zbroken|":1,"|-activate|":1,"|-fieldactivate|":1,"|-hint|":1,"|-center|":1,"|-message|":1,"|-combine|":1,"|-waiting|":1,"|-prepare|":1,"|-mustrecharge|":1,"|-hitcount|":1,"|-singlemove|":1,"|-singleturn|":1,"|-anim|":1,"|warning|":1,"|-candynamax|":1,"|updatepoke|":1,"|-swapsideconditions|":1,"|-terastallize|":1,"|sentchoice|":1,"|customgroups|":1},this.ARGS_WITH_KWARGS={"|move|":1,"|switch|":1,"|cant|":1,"|-formechange|":1,"|-fail|":1,"|-block|":1,"|-damage|":1,"|-heal|":1,"|-sethp|":1,"|-status|":1,"|swap|":1,"|-curestatus|":1,"|-cureteam|":1,"|-boost|":1,"|-unboost|":1,"|-setboost|":1,"|-swapboost|":1,"|-invertboost|":1,"|-clearnegativeboost|":1,"|-weather|":1,"|-fieldstart|":1,"|-fieldend|":1,"|-sidestart|":1,"|-singlemove|":1,"|-sideend|":1,"|-start|":1,"|-end|":1,"|-immune|":1,"|-item|":1,"|-enditem|":1,"|-ability|":1,"|-endability|":1,"|-transform|":1,"|-activate|":1,"|-singleturn|":1,"|-clearallboost|":1,"|-anim|":1,"|-copyboost|":1,"|-clearboost|":1,"|-miss|":1}}*parse(e){const t=e.split("\n");let s="";for(const[r,a]of t.entries())if(0!==r||">"!==a[0]){if(a){const{args:e,kwArgs:t}=this.parseBattleLine(a);yield{roomid:s,args:e,kwArgs:t}}}else s=a.slice(1)}key(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s="tournament"===e[0]?"|".concat(e[0],"|").concat(e[1],"|"):"|".concat(e[0],"|");return t||s in this.ARGS?s:void 0}parseLine(e,t){if(!e.startsWith("|"))return["",e];if("|"===e)return["done"];const r=e.indexOf("|",1),a=e.slice(1,r);switch(a){case"chatmsg":case"chatmsg-raw":case"raw":case"error":case"html":case"inactive":case"inactiveoff":case"warning":case"fieldhtml":case"controlshtml":case"bigerror":case"debug":case"tier":case"challstr":case"popup":case"":return s([a,e.slice(r+1)]);case"c":case"chat":case"uhtml":case"uhtmlchange":const t=e.indexOf("|",r+1);return s([a,e.slice(r+1,t),e.slice(t+1)]);case"c:":case"pm":const n=e.indexOf("|",r+1),o=e.indexOf("|",n+1);return s([a,e.slice(r+1,n),e.slice(n+1,o),e.slice(o+1)])}return t?null:s(e.slice(1).split("|"))}parseBattleLine(c){let l=t.parseLine(c,!0);if(l)return{args:l,kwArgs:{}};l=c.slice(1).split("|");const u={};for(;l.length>1;){const e=l[l.length-1];if("["!==e.charAt(0))break;const t=e.indexOf("]");if(t<=0)break;u[e.slice(1,t)]=e.slice(t+1).trim()||!0,l.pop()}return function(s){let{args:c,kwArgs:l}=s;switch(c[0]){case"-activate":{if(l.item||l.move||l.number||l.ability)return{args:c,kwArgs:l};const[,s,a,i,u]=c,m=a,d=l.of,p=t.parseEffect(m,e).name;if(l.block)return{args:["-fail",s],kwArgs:l};if("sturdy"===p)return{args:["-activate",s,"ability: Sturdy"],kwArgs:l};if("wonderguard"===p)return{args:["-immune",s],kwArgs:{from:"ability: Wonder Guard"}};if("beatup"===p&&l.of)return{args:c,kwArgs:{name:l.of}};if(r.has(p))return d?(l.of=s,{args:["-block",d,m,i||""],kwArgs:l}):{args:["-block",s,m,i||""],kwArgs:l};if("charge"===p)return{args:["-singlemove",s,"Charge"],kwArgs:{of:d||void 0}};if(n.has(p))return{args:["-start",s,m],kwArgs:{of:d||""}};if("fairylock"===p)return{args:["-fieldactivate",m],kwArgs:{}};if("symbiosis"===p||"poltergeist"===p)l.item=i;else if("magnitude"===p)l.number=i;else if("skillswap"===p||"mummy"===p||"lingeringaroma"===p)l.ability=i,l.ability2=u;else if("wanderingspirit"===p){if(!i)return{args:["-ability",s,"Wandering Spirit"],kwArgs:{}};l.ability=i,l.ability2=u}else o.has(p)&&(l.move=i,l.number=u);return{args:["-activate",s,m,d||""],kwArgs:l}}case"-start":"Protean"!==l.from&&"Color Change"!==l.from||(l.from="ability:"+l.from);break;case"move":"Magic Bounce"===l.from&&(l.from="ability: Magic Bounce");break;case"cant":{const[,e,t,s]=c;if(a.has(t))return{args:["-block",e,t,s,l.of||""],kwArgs:{}};break}case"-heal":{const s=t.parseEffect(l.from,e).name;i.has(s)&&(l.of="");break}case"gen":{const[,e]=c;return{args:["gen",Number(e)],kwArgs:{}}}case"-restoreboost":c[0]="-clearnegativeboost";break;case"-nothing":c=["-activate","","move: Splash"]}return{args:c,kwArgs:l}}({args:s(l),kwArgs:u})}parsePokemonIdent(e){const t=e.indexOf(":"),s=e.slice(0,t),r=e.slice(t+2);let a,n;return s.length<3?(a=s,n=null):(a=s.slice(0,2),n=s.charAt(2)),{player:a,position:n,name:r}}parseDetails(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.details=s;const a=!e;r.name=e,r.speciesForme=e,r.level=100,r.shiny=!1,r.gender=void 0,r.ident=a?"":t,r.searchid=a?"":"".concat(t,"|").concat(s);const n=s.split(", ");n[n.length-1].startsWith("tera:")&&(r.terastallized=n[n.length-1].slice(5),n.pop()),"shiny"===n[n.length-1]&&(r.shiny=!0,n.pop());const o=n[n.length-1];return"M"!==o&&"F"!==o||(r.gender=o,n.pop()),n[1]&&(r.level=parseInt(n[1].substr(1))||100),n[0]&&(r.speciesForme=n[0]),r}parseHealth(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[s,r]=e.split(" ");if(t.hpcolor="","0"===s||"0.0"===s)t.maxhp||(t.maxhp=100),t.hp=0;else if(s.indexOf("/")>0){const[e,r]=s.split("/");if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))return null;t.hp=parseFloat(e),t.maxhp=parseFloat(r),t.hp>t.maxhp&&(t.hp=t.maxhp);const a=r.slice(-1);"y"!==a&&"g"!==a||(t.hpcolor=a)}else isNaN(parseFloat(s))||(t.maxhp||(t.maxhp=100),t.hp=t.maxhp*parseFloat(s)/100);return r?"par"===r||"brn"===r||"slp"===r||"frz"===r||"tox"===r||"psn"===r&&"tox"!==t.status?t.status=r:"fnt"===r&&(t.hp=0,t.fainted=!0):t.status=void 0,t}parseEffect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e.trim();return e?e.startsWith("item:")||e.startsWith("move:")?{name:t(e.slice(5)),type:e.slice(0,4)}:e.startsWith("ability:")?{name:t(e.slice(8)),type:"ability"}:{name:t(e)}:{name:t("")}}parseRequest(t){const s=JSON.parse(t);if(s.requestType||(s.requestType="move",s.forceSwitch?s.requestType="switch":s.teamPreview?s.requestType="team":s.wait&&(s.requestType="wait")),"wait"===s.requestType&&(s.noCancel=!0),s.side)for(const e of s.side.pokemon)this.parseDetails(e.ident.substr(4),e.ident,e.details,e),this.parseHealth(e.condition,e),e.ability=e.ability||e.baseAbility;if(s.active){s.active=s.active.map(((e,t)=>s.side.pokemon[t].fainted?null:e));for(const t of s.active)if(t){for(const s of t.moves)s.move&&(s.name=s.move),s.id=e(s.name);if(t.maxMoves){t.maxMoves.maxMoves&&(t.canGigantamax=t.maxMoves.gigantamax,t.maxMoves=t.maxMoves.maxMoves);for(const e of t.maxMoves)e.id=e.move}if(t.canZMove){t.zMoves=t.canZMove;for(const s of t.zMoves)s&&(s.move&&(s.name=s.move),s.id=e(s.name))}}}return s}parseChallenges(e){return JSON.parse(e)}parseSearchState(e){return JSON.parse(e)}parseTournamentUpdate(e){return JSON.parse(e)}parseCustomGroupsJSON(e){return JSON.parse(e)}parseNameParts(e){let t="";/[A-Za-z0-9]/.test(e.charAt(0))||(t=e.charAt(0),e=e.slice(1));let s=e;const r=e.indexOf("@");let a="",n=!1;return r>0&&(s=e.slice(0,r),a=e.slice(r+1),a.startsWith("!")&&(n=!0,a=a.slice(1))),{group:t,name:s,away:n,status:a}}};function s(e){switch(e[0]){case"name":case"n":case"N":{const[t,s,r]=e;return["name",s,r,"N"===t]}case"chat":case"c":{const[,t,s]=e;return["chat",t,s]}case"join":case"j":case"J":{const[t,s]=e;return["join",s,"J"===t]}case"leave":case"l":case"L":{const[t,s]=e;return["leave",s,"L"===t]}case"battle":case"b":{const[,t,s,r]=e;return["battle",t,s,r]}}return e}var r=new Set(["ingrain","quickguard","wideguard","craftyshield","matblock","protect","mist","safeguard","electricterrain","mistyterrain","psychicterrain","telepathy","stickyhold","suctioncups","aromaveil","flowerveil","sweetveil","disguise","safetygoggles","protectivepads"]),a=new Set(["ability: Damp","ability: Dazzling","ability: Queenly Majesty","ability: Armor Tail"]),n=new Set(["thundercage","clamp","whirlpool","firespin","magmastorm","sandtomb","infestation","trapped","bind","snaptrap","wrap"]),o=new Set(["eeriespell","gmaxdepletion","spite","grudge","forewarn","sketch","leppaberry","mysteryberry"]),i=new Set(["dryskin","eartheater","voltabsorb","waterabsorb"]);var c="https://play.pokemonshowdown.com/",l="application/x-www-form-urlencoded; encoding=UTF-8";function u(e){return e.password?{...d("login",e,p({serverid:e.serverid,name:e.username,pass:e.password,challstr:e.challstr})),onResponse:t=>{var s;const r=h(t);return(null==(s=r.curuser)?void 0:s.loggedin)?f(e,r.assertion):w(e,r)}}:m(e)}function m(e){return e.password?u(e):{...d("getassertion",e,p({serverid:e.serverid,userid:g(e.username),challstr:e.challstr})),onResponse:t=>f(e,t)}}function d(e,t,s){return{method:"POST",url:"".concat((null==t?void 0:t.url)||c,"api/").concat(e),headers:{"Content-Type":l,"Content-Length":s.length},data:s,responseType:"text"}}function p(e){const t=[];for(const s in e)void 0!==e[s]&&t.push("".concat(s,"=").concat(encodeURIComponent(e[s])));return t.join("&")}function h(e){if(!e||e.length<1)throw new Error("No data received");return"]"===e[0]&&(e=e.substr(1)),JSON.parse(e)}function g(e){return(null==e?void 0:e.id)&&(e=e.id),"string"!==typeof e&&"number"!==typeof e?"":(""+e).toLowerCase().replace(/[^a-z0-9]+/g,"")}function f(e,t){return"|/trn ".concat(e.username,",0,").concat(v(e,t))}function w(e,t){const s=t.error||t.actionerror;if(s)throw new Error(s);throw v(e,t.assertion||""),new Error("Received unexpected response: ']".concat(JSON.stringify(t),"'"))}function v(e,t){if("<!doctype html"===t.slice(0,14).toLowerCase()){const e=t.indexOf(">");e>0&&(t=t.slice(e+1))}if(t.startsWith("\r")&&(t=t.slice(1)),t.startsWith("\n")&&(t=t.slice(1)),t.includes("<"))throw new Error("Something appears to be interfering with the connection");if(";"===t)throw new Error("Authentication required for '".concat(e.username,"'"));if(";;@gmail"===t)throw new Error("Authentication from Google required for '".concat(e.username,"'"));if(t.startsWith(";;"))throw new Error("Invalid name: ".concat(t.substr(2)));if(t.includes("\n")||!t)throw new Error("Something appears to be interfering with the connection");return t}var b={register:function(e){var t,s;return{...d("register",e,p({serverid:e.serverid,username:e.username,password:e.password,cpassword:null!=(t=e.cpassword)?t:e.password,captcha:null!=(s=e.captcha)?s:"Pikachu",challstr:e.challstr})),onResponse:t=>{var s;const r=h(t);return(null==(s=r.curuser)?void 0:s.loggedin)?f(e,r.assertion):w(e,r)}}},login:u,upkeep:function(e){return{...d("upkeep",e,p({serverid:e.serverid,challstr:e.challstr})),onResponse:t=>{const s=h(t);if(s.username)return f({...e,username:s.username},s.assertion)}}},rename:m,logout:function(e){return{...d("logout",e,p({serverid:e.serverid,userid:g(e.username)})),onResponse:()=>"|/logout"}}};const y="\x1b[32m",k="\x1b[36m",x="";function A(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:console.log)("".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:x).concat(e))}const S=class{constructor(){this.ws=void 0}open(e){this.ws=new WebSocket("ws://".concat("sim.smogon.com",":").concat(8e3,"/showdown/websocket")),this.ws.onmessage=t=>{let{data:s}=t;A("Message received:\n".concat(s),console.debug,k),e(s)},this.ws.onopen=()=>{A("Connected to ".concat(this.ws.url))},this.ws.onclose=e=>{const t=e.wasClean?" cleanly ":" ",s=e.reason?": ".concat(e.reason):"";A("Disconnected".concat(t,"from ").concat(this.ws.url," with ").concat(e.code).concat(s))},this.ws.onerror=e=>{const t=e.message;"TIMEOUT"!==t&&A("Connection error".concat(t?": ".concat(t):""),console.error)}}close(){this.ws.close()}send(e){this.ws.send(e),A("Message sent:\n".concat(e),console.debug,y)}};class C extends S{constructor(){super(...arguments),this.roomid=""}send(e){super.send((this.roomid?">".concat(this.roomid,"\n"):"")+e)}sendCommand(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.send("/".concat(e," ").concat(t.join(", ")))}}globalThis.onmessage=e=>{let{data:s}=e;const{username:r,password:a,puzzle:n,challenger:o}=s,i=new C,c=new class{async"|challstr|"(e){const t=e[1],s=b.login({username:r,password:a,challstr:t}),o=await(await fetch("https://corsproxy.io/?"+s.url,{method:s.method,headers:s.headers,body:s.data})).text(),c=s.onResponse(o);c&&i.send(c),n.avatar&&i.sendCommand("avatar",[n.avatar]),this.challenge()}"|updateuser|"(e){A("Logged in as `".concat(e[1].trim(),"` with avatar `").concat(e[3],"`"))}"|init|"(e){A("Beginning ".concat(e[1]))}"|request|"(e){if(e[1]){const{active:t,side:s}=JSON.parse(e[1])}}"|-crit|"(e){n.crits||(i.send("Critical hit detected. Aborting puzzle and resending a challenge to ".concat(o,".")),i.sendCommand("forfeit"),this.challenge())}challenge(){i.sendCommand("challenge",[o,"gen9nationaldexubers"])}};i.open((e=>{const s=t.parse(e.toString());let r=s.next();for(;!r.done;){const{roomid:e,args:a,kwArgs:n}=r.value,o=t.key(a);o&&o in c&&(i.roomid=e,c["".concat(o)](a,n)),r=s.next()}}))}})();
//# sourceMappingURL=96.33ea501b.chunk.js.map